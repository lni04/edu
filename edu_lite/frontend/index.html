<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教务管理系统</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f0f2f5; min-height: 100vh; }
        
        .login-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .login-box { width: 380px; padding: 40px; background: #fff; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .login-box h2 { text-align: center; margin-bottom: 30px; color: #333; font-size: 24px; }
        .login-box input { width: 100%; padding: 14px; margin-bottom: 16px; border: 1px solid #d9d9d9; border-radius: 6px; font-size: 15px; }
        .login-box input:focus { border-color: #1890ff; outline: none; }
        .login-box button { width: 100%; padding: 14px; background: #1890ff; color: #fff; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; }
        .login-box button:hover { background: #40a9ff; }
        .login-box button:disabled { background: #d9d9d9; }
        
        .container { display: flex; min-height: 100vh; }
        .sidebar { width: 220px; background: linear-gradient(180deg, #001529 0%, #002140 100%); }
        .sidebar h3 { color: #fff; padding: 24px 20px; font-size: 18px; border-bottom: 1px solid #0d2137; }
        .sidebar .menu { padding: 10px 0; }
        .sidebar .menu-item { display: block; color: rgba(255,255,255,0.7); padding: 14px 24px; cursor: pointer; transition: all 0.3s; }
        .sidebar .menu-item:hover { color: #fff; background: rgba(255,255,255,0.05); }
        .sidebar .menu-item.active { color: #fff; background: #1890ff; }
        
        .main { flex: 1; display: flex; flex-direction: column; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; background: #fff; box-shadow: 0 1px 4px rgba(0,0,0,0.08); }
        .header .user-info { color: #333; font-size: 15px; }
        .header .logout-btn { padding: 8px 16px; background: #ff4d4f; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
        
        .content { flex: 1; padding: 24px; overflow-y: auto; }
        .card { background: #fff; border-radius: 8px; padding: 24px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .card-title { font-size: 18px; font-weight: 600; color: #333; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 1px solid #f0f0f0; }
        
        .info-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .info-item { background: #fafafa; padding: 16px; border-radius: 6px; }
        .info-item .label { font-size: 13px; color: #8c8c8c; margin-bottom: 6px; }
        .info-item .value { font-size: 18px; color: #262626; font-weight: 500; }
        
        table { width: 100%; border-collapse: collapse; }
        th { background: #fafafa; padding: 14px 12px; text-align: left; font-weight: 500; color: #666; border-bottom: 1px solid #f0f0f0; }
        td { padding: 14px 12px; border-bottom: 1px solid #f0f0f0; color: #333; }
        tr:hover { background: #fafafa; }
        
        .semester-block { margin-bottom: 28px; }
        .semester-title { font-size: 16px; color: #1890ff; margin-bottom: 12px; font-weight: 500; }
        
        .gpa-display { text-align: center; padding: 40px; }
        .gpa-number { font-size: 64px; color: #1890ff; font-weight: 700; }
        .gpa-label { font-size: 14px; color: #8c8c8c; margin-top: 8px; }
        
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
        .btn-primary { background: #1890ff; color: #fff; }
        .btn-primary:hover { background: #40a9ff; }
        .btn-primary:disabled { background: #d9d9d9; cursor: not-allowed; }
        .btn-success { background: #52c41a; color: #fff; }
        
        .msg { padding: 12px 16px; border-radius: 4px; margin-bottom: 16px; }
        .msg.success { background: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
        .msg.error { background: #fff2f0; color: #ff4d4f; border: 1px solid #ffccc7; }
        
        .empty { text-align: center; padding: 40px; color: #bfbfbf; }
        .loading { text-align: center; padding: 40px; color: #8c8c8c; }

        @media (max-width: 768px) {
            .info-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
<div id="app">
    <!-- 登录页 -->
    <div v-if="!loggedIn" class="login-container">
        <div class="login-box">
            <h2>教务管理系统</h2>
            <input v-model="form.student_id" placeholder="学号（测试：2024001）" @keyup.enter="login">
            <input v-model="form.password" type="password" placeholder="密码（测试：123456）" @keyup.enter="login">
            <div v-if="error" class="msg error">{{ error }}</div>
            <button @click="login" :disabled="loading">{{ loading ? '登录中...' : '登 录' }}</button>
        </div>
    </div>

    <!-- 主界面 -->
    <div v-else class="container">
        <div class="sidebar">
            <h3>教务系统</h3>
            <div class="menu">
                <div class="menu-item" :class="{active: page==='profile'}" @click="go('profile')">个人信息</div>
                <div class="menu-item" :class="{active: page==='grades'}" @click="go('grades')">我的成绩</div>
                <div class="menu-item" :class="{active: page==='gpa'}" @click="go('gpa')">绩点查询</div>
                <div class="menu-item" :class="{active: page==='courses'}" @click="go('courses')">选课中心</div>
            </div>
        </div>
        
        <div class="main">
            <div class="header">
                <span class="user-info">欢迎您，{{ user.name }}（{{ user.student_id }}）</span>
                <button class="logout-btn" @click="logout">退出登录</button>
            </div>
            
            <div class="content">
                <!-- 个人信息 -->
                <div v-if="page==='profile'">
                    <div class="card">
                        <div class="card-title">个人信息</div>
                        <div v-if="loadingData" class="loading">加载中...</div>
                        <div v-else class="info-grid">
                            <div class="info-item"><div class="label">学号</div><div class="value">{{ profile.student_id }}</div></div>
                            <div class="info-item"><div class="label">姓名</div><div class="value">{{ profile.name }}</div></div>
                            <div class="info-item"><div class="label">班级</div><div class="value">{{ profile.class_name }}</div></div>
                            <div class="info-item"><div class="label">手机号码</div><div class="value">{{ profile.phone || '未填写' }}</div></div>
                            <div class="info-item"><div class="label">已修学分</div><div class="value">{{ profile.total_credit }}</div></div>
                            <div class="info-item"><div class="label">总绩点(GPA)</div><div class="value">{{ profile.gpa }}</div></div>
                        </div>
                        <p style="margin-top:20px;color:#8c8c8c;font-size:13px;">提示：修改 data.php 文件中的学生信息后刷新页面即可看到变化</p>
                    </div>
                </div>

                <!-- 成绩查询 -->
                <div v-if="page==='grades'">
                    <div class="card">
                        <div class="card-title">成绩查询</div>
                        <div v-if="loadingData" class="loading">加载中...</div>
                        <template v-else>
                            <div v-if="Object.keys(grades).length === 0" class="empty">暂无成绩记录</div>
                            <div v-for="(list, sem) in grades" :key="sem" class="semester-block">
                                <div class="semester-title">{{ sem }}</div>
                                <table>
                                    <thead><tr><th>课程号</th><th>课程名称</th><th>学分</th><th>平时成绩</th><th>期末成绩</th><th>总评</th><th>绩点</th></tr></thead>
                                    <tbody>
                                        <tr v-for="g in list" :key="g.course_id">
                                            <td>{{ g.course_id }}</td>
                                            <td>{{ g.course_name }}</td>
                                            <td>{{ g.credit }}</td>
                                            <td>{{ g.usual_score }}</td>
                                            <td>{{ g.final_score }}</td>
                                            <td><strong>{{ g.total_score }}</strong></td>
                                            <td>{{ g.grade_point }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </template>
                        <p style="margin-top:20px;color:#8c8c8c;font-size:13px;">提示：修改 data.php 文件中的 $SCORES 数组即可改变成绩显示</p>
                    </div>
                </div>

                <!-- 绩点查询 -->
                <div v-if="page==='gpa'">
                    <div class="card">
                        <div class="card-title">绩点统计</div>
                        <div v-if="loadingData" class="loading">加载中...</div>
                        <template v-else>
                            <div class="gpa-display">
                                <div class="gpa-number">{{ gpaInfo.gpa || '0.00' }}</div>
                                <div class="gpa-label">总绩点 (GPA) | 总学分：{{ gpaInfo.total_credit || 0 }}</div>
                            </div>
                            <div class="card-title" style="margin-top:30px;">各学期绩点明细</div>
                            <table v-if="gpaInfo.semesters && gpaInfo.semesters.length">
                                <thead><tr><th>学期</th><th>学分</th><th>学期绩点</th></tr></thead>
                                <tbody>
                                    <tr v-for="s in gpaInfo.semesters" :key="s.semester">
                                        <td>{{ s.semester }}</td><td>{{ s.credit }}</td><td><strong>{{ s.gpa }}</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                            <div v-else class="empty">暂无学期数据</div>
                        </template>
                    </div>
                </div>

                <!-- 选课中心 -->
                <div v-if="page==='courses'">
                    <div class="card">
                        <div class="card-title">选课中心</div>
                        <div v-if="msg" :class="['msg', msg.type]">{{ msg.text }}</div>
                        <div v-if="loadingData" class="loading">加载中...</div>
                        <table v-else>
                            <thead><tr><th>课程号</th><th>课程名称</th><th>教师</th><th>学分</th><th>学期</th><th>容量</th><th>已选</th><th>剩余</th><th>操作</th></tr></thead>
                            <tbody>
                                <tr v-for="c in courses" :key="c.course_id">
                                    <td>{{ c.course_id }}</td>
                                    <td>{{ c.course_name }}</td>
                                    <td>{{ c.teacher }}</td>
                                    <td>{{ c.credit }}</td>
                                    <td>{{ c.semester }}</td>
                                    <td>{{ c.capacity }}</td>
                                    <td>{{ c.enrolled }}</td>
                                    <td>{{ c.remaining }}</td>
                                    <td>
                                        <button class="btn btn-primary" @click="selectCourse(c.course_id)" :disabled="c.remaining <= 0 || selecting">
                                            {{ c.remaining > 0 ? '选课' : '已满' }}
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <p style="margin-top:20px;color:#8c8c8c;font-size:13px;">提示：修改 data.php 文件中的 $COURSES 数组即可改变课程列表</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// ========== 配置API地址（根据你的实际路径修改）==========
const API = '/edu_lite';

const { createApp, ref, reactive, onMounted } = Vue;

createApp({
    setup() {
        // 状态
        const loggedIn = ref(false);
        const user = ref({});
        const page = ref('profile');
        const form = reactive({ student_id: '', password: '' });
        const error = ref('');
        const loading = ref(false);
        const loadingData = ref(false);
        const msg = ref(null);
        const selecting = ref(false);
        
        // 数据
        const profile = ref({});
        const grades = ref({});
        const gpaInfo = ref({});
        const courses = ref([]);

        // 检查本地存储
        onMounted(() => {
            const saved = localStorage.getItem('edu_user');
            if (saved) {
                try {
                    user.value = JSON.parse(saved);
                    loggedIn.value = true;
                    loadProfile();
                } catch(e) {}
            }
        });

        // 登录
        async function login() {
            error.value = '';
            if (!form.student_id || !form.password) {
                error.value = '请输入学号和密码';
                return;
            }
            loading.value = true;
            try {
                const res = await axios.post(API + '/login', form);
                if (res.data.code === 0) {
                    user.value = res.data.data.user;
                    loggedIn.value = true;
                    localStorage.setItem('edu_user', JSON.stringify(user.value));
                    loadProfile();
                } else {
                    error.value = res.data.msg;
                }
            } catch(e) {
                error.value = e.response?.data?.msg || '登录失败，请检查接口地址';
            }
            loading.value = false;
        }

        // 登出
        function logout() {
            loggedIn.value = false;
            user.value = {};
            localStorage.removeItem('edu_user');
        }

        // 切换页面
        function go(p) {
            page.value = p;
            msg.value = null;
            if (p === 'profile') loadProfile();
            else if (p === 'grades') loadGrades();
            else if (p === 'gpa') loadGpa();
            else if (p === 'courses') loadCourses();
        }

        // 加载个人信息
        async function loadProfile() {
            loadingData.value = true;
            try {
                const res = await axios.get(API + '/student/' + user.value.student_id + '/profile');
                if (res.data.code === 0) profile.value = res.data.data;
            } catch(e) { console.error(e); }
            loadingData.value = false;
        }

        // 加载成绩
        async function loadGrades() {
            loadingData.value = true;
            try {
                const res = await axios.get(API + '/student/' + user.value.student_id + '/grades');
                if (res.data.code === 0) grades.value = res.data.data;
            } catch(e) { console.error(e); }
            loadingData.value = false;
        }

        // 加载绩点
        async function loadGpa() {
            loadingData.value = true;
            try {
                const res = await axios.get(API + '/student/' + user.value.student_id + '/gpa');
                if (res.data.code === 0) gpaInfo.value = res.data.data;
            } catch(e) { console.error(e); }
            loadingData.value = false;
        }

        // 加载课程
        async function loadCourses() {
            loadingData.value = true;
            try {
                const res = await axios.get(API + '/courses');
                if (res.data.code === 0) courses.value = res.data.data;
            } catch(e) { console.error(e); }
            loadingData.value = false;
        }

        // 选课
        async function selectCourse(courseId) {
            msg.value = null;
            selecting.value = true;
            try {
                const res = await axios.post(API + '/select', {
                    student_id: user.value.student_id,
                    course_id: courseId
                });
                if (res.data.code === 0) {
                    msg.value = { type: 'success', text: res.data.msg };
                    loadCourses();
                } else {
                    msg.value = { type: 'error', text: res.data.msg };
                }
            } catch(e) {
                msg.value = { type: 'error', text: e.response?.data?.msg || '选课请求失败' };
            }
            selecting.value = false;
        }

        return {
            loggedIn, user, page, form, error, loading, loadingData, msg, selecting,
            profile, grades, gpaInfo, courses,
            login, logout, go, selectCourse
        };
    }
}).mount('#app');
</script>
</body>
</html>
